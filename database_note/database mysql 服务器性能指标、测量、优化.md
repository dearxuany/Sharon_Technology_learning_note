# mysql 服务器性能指标、测量、优化
分析 mysql 性能时，一般指分析 mysql 的查询
## 服务器性能
### 定义
服务器性能为“响应时间”，“响应时间”分为“执行时间”和“等待时间”。</br>
* 执行时间：什么任务执行时间最长
* 等待时间：任务在什么地方被阻塞时间最长
### 性能测量
步骤：</br>
* 测任务所花费时间
* 对测量结果进行统计排序，优先级高的放在前面</br>

工具：</br>
New Relic、xhprof、IFp
### 性能优化
优化原则：</br>
* 优化占总响应时间比重多的查询（>5%）
* 优化收益大于成本
* 优化离差指数高（方差均值：查询执行时间波动大）的查询

## MySQL查询性能
### 分析多条查询
#### 慢查询日志
优点：开销低、精度高</br>
缺点：消耗大量磁盘，要定时log rotate</br>
一般用法是将慢查询日志文件作为参数传递给 pt-query-digest 进行分析
#### 抓包
使用 tcpdump 

### 分析单条查询
#### SHOW PROFILE
启动 profiling 以后，profile 会记录服务器上执行的所有语句并测量其耗费时间、以及记录其他一些执行状态相关信息。
```
# 默认关闭，需启动，每次重新登录数据库都要重启
MariaDB [sakila]> SET profiling=1;
```
实例：
MySQL Sakila样本数据库查询
```

```
